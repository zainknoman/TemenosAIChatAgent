# frontend/nginx/nginx.conf
# This file will be copied to /etc/nginx/conf.d/default.conf
# Simplified configuration for initial debugging.

server {
    listen 80; # Nginx listens on port 80 inside the container
    server_name localhost;

    # Set up logging for this server block
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log debug; # 'debug' level for more verbosity

    root /usr/share/nginx/html; # Points to where React build output is copied
    index index.html; # Explicitly set index file

    # Define Content Security Policy (kept for functionality, but simplified)
    add_header Content-Security-Policy "
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://www.gstatic.com;
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: https://placehold.co;
        connect-src 'self' http://backend:3001 http://localhost:3001;
    " always;

    # Removed sendfile and keepalive_timeout for maximum compatibility during debugging
    # sendfile on;
    # keepalive_timeout 65;

    # For React Router (or any client-side routing), all unknown paths should
    # fallback to index.html so the React app can handle routing.
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Optional: Handle 404 errors by serving index.html as well
    error_page 404 /index.html;
    location = /index.html {
        internal;
    }
}
